{% if lesson.task_type == 'html' %}
  <h3>{{ lesson.html_task_description }}</h3>

  <textarea id="codeInput" style="width:100%; height:100px;"></textarea>
  <button onclick="runTest()">Проверить</button>
  <iframe id="sandbox" sandbox="allow-scripts" style="width:100%; height:200px;"></iframe>
  <div id="feedback" style="margin-top: 10px;"></div>

  <script>
    const expected = `{{ expected_output|escapejs }}`.trim();

    function runTest() {
      const userCode = document.getElementById("codeInput").value;
      const iframe = document.getElementById("sandbox");
      const testScript = `
        <script>
          const val = document.getElementById('output')?.innerText || '';
          parent.postMessage(val, '*');
        <\/script>
      `;
      iframe.srcdoc = `<body>${userCode}${testScript}</body>`;
    }

    window.addEventListener("message", (e) => {
      const fb = document.getElementById("feedback");
      if (e.data.trim() === expected) {
        fb.innerHTML = '<span style="color: green;">✅ Верно!</span>';
      } else {
        fb.innerHTML = '<span style="color: red;">❌ Ожидалось: "' + expected + '". Получено: "' + e.data + '"</span>';
      }
    });
  </script>
{% endif %}
